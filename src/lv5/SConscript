import sys
import os
import glob
from os.path import join, dirname, abspath
Import('context object_files root_dir')

objs = [os.path.splitext(x)[0]+'.o' for x in glob.glob('*.cc')]

def Build():
  jscre = context.SConscript(
    'third_party/jscre/SConscript',
    variant_dir=join(root_dir, 'obj', 'third_party', 'jscre'),
    duplicate=False,
    exports="context"
  )
  conf = Configure(context.Clone())
  if conf.CheckLib('boost_thread'):
    conf.env.Append(
        LIBS='boost_thread')
  env = conf.Finish()
  env.Append(
      LIBS=['gc'],
      CCFLAGS=["-fno-strict-aliasing"],
      CPPDEFINES=["__STDC_FORMAT_MACROS"]
      )
  return env.Program('lv5',
      [Glob('*.cc'), Glob('*.c'), object_files, jscre])

program = Build()
Return('program')
